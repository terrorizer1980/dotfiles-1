#!/bin/bash

c1="\33[1;34m"
c2="\33[1;33m"
c3="\33[0;32m"
c4="\33[0;31m"
c5="\33[0;90m"
nc="\33[0m"

setup ()
{
    file="$HOME/dotfiles/bin/.install"

    if [[ ! -f "$file" ]]; then
        printf "\n${c3}Using default options.${nc}\n"
        file="$HOME/dotfiles/bin/.install.defaults"
    else
        printf "\n${c3}Configuration file detected.${nc}\n"
    fi

    while read -r line; do
        pre_install "$line"
    done < $file

    printf "\n${c3}Happy hacking!${nc}\n"
}

pre_install ()
{
    line=$1
    opt=${line:0:1}
    name=${line:2}

    if [[ "$opt" == "+" ]]; then
        install "$name"
    fi
}

install ()
{
    name=$1

    echo -e "\nInstalling $name config..."

    case "$name" in
        "Atom")
            symlink ".atom" ".atom";;
        "Emacs")
            symlink ".emacs.d" ".emacs.d";;
        "Homebrew")
            symlink "Brewfile" "Brewfile";;
        "Neovim")
            symlink ".vimrc" ".config/nvim/init.mv";;
            symlink "banner-nvim" ".config/nvim/banner";;
        "Prezto")
            symlink ".zpreztorc" ".zpreztorc"
            symlink "prompt_ngscheurich_setup"\
                    ".zprezto/modules/prompt/functions/prompt_ngscheurich_setup";;
        "Pry")
            symlink ".pryrc" ".pryrc";;
        "Rubocop")
            symlink ".rubocop.yml" ".rubocop.yml";;
        "The Silver Searcher")
            symlink ".agignore" ".agignore";;
        "Slate")
            symlink "slate/.slate.js" ".slate.js";;
        "Sublime Text")
            symlink "Preferences.sublime-settings"\
                    "Library/Application Support/Sublime Text 3/Packages/User/Preferences.sublime-settings";;
        "Vim")
            symlink ".vimrc" ".vimrc";;
            symlink "banner-nvim" ".vim/banner";;
        "Zsh")
            symlink ".zshrc" ".zshrc"
            symlink ".zshenv" ".zshenv";;
        "tmux")
            symlink ".tmux.conf" ".tmux.conf";;
            symlink ".tmuxline" ".tmuxline";;
        *)
            echo "$name is not a recognized application"
    esac
}

symlink ()
{
  orig="$HOME/dotfiles/$1"
  dest="$HOME/$2"

  ln -fs $orig $dest

  printf "${c5}>${nc} Linked ${c1}$orig${nc} to ${c2}$dest${nc}\n"
}

# And awaaaaaaay we go!
setup
